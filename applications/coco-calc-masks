import argparse
import numpy as np
from pycocotools.coco import COCO
import pycocotools.mask as mask
import matplotlib.pyplot as plt
import sys
sys.path.append("/home/stevep/src/abyss/deep-learning/lib")
import coco_classes

def main(args):
    coco = COCO(args.coco_path)
    for ann in coco.anns.values():
        ann['segmentation'] = mask.encode(coco.annToMask(ann))
    coco2 = coco_classes.CocoDataset.from_COCO(coco, image_dir=args.image_dir)
    print(str(coco2))

def get_args():
    parser = argparse.ArgumentParser(
     description="Split a COCO JSON database into multiple."
    )
    parser.add_argument('coco_path', help="Path to the coco JSON.")
    parser.add_argument('--verbose', action='store_true', help="verbose output to stderr")
    parser.add_argument("--image-dir", help="If images referenced relatively, give the iamge dir", default=None)
    args = parser.parse_args()
    return args

if __name__ == '__main__':
    main(get_args())

